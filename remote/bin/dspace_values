#! /bin/bash
#
# Script values -- intended to be "sourced" not run -- within a DSpace shell.

ERROR_STATUS=100

# Ensure that dspace_util scripts are available.
[[ "$PROGRAM"  ]] || PROGRAM=`realpath "$0"`
[[ "$BIN_DIR"  ]] || BIN_DIR=`dirname "$PROGRAM"`
[[ "$PROGNAME" ]] || PROGNAME=`basename "$PROGRAM"`

[[ ":$PATH:" == *":$BIN_DIR:"* ]] || PATH="$BIN_DIR:$PATH"

# =============================================================================
# Functions
# =============================================================================

function abort() # output_lines...
{
    for MSG in "$@" ; do
        echo "$MSG" 1>&2
    done
    exit $ERROR_STATUS
}

function blank() # value
{
    [[ "$1" =~ ^' '*$ ]]
}

function flag_arg() # --flag=value | --flag value
{
    local FLAG="$1"                         # "--flag=value" or "flag value".
    local VALUE="${FLAG#*=}"                # Check for "--flag=value".
    [[ "$VALUE" == "$FLAG" ]] && VALUE="$2" # Default to "flag value".
    blank "$VALUE" && abort "missing $FLAG argument"
    echo "$VALUE"
}

# =============================================================================
# DSpace variations
# =============================================================================

[[ "$DSPACE_DEPLOYMENT" ]] || export DSPACE_DEPLOYMENT=`dspace_deployment`
[[ "$DSPACE_DEPLOYMENT" ]] || abort "unexpected hostname '`hostname`'"

if [[ ! "$DSPACE_DOCKER" ]] ; then
    export DSPACE_DOCKER=''
    [[ "$DSPACE_DEPLOYMENT" == 'development' ]] && DSPACE_DOCKER=true
fi

export IMPORT_DIR='import'
export IMPORT_PATH="$HOME/$IMPORT_DIR"

if [[ "$DSPACE_DOCKER" ]] ; then
    export HOST_IMPORT_PATH='/opt/dspace-docker/imports/rwl'
    export DSPACE_IMPORT_PATH='/dspace/imports/rwl'
else
    export HOST_IMPORT_PATH="$IMPORT_PATH"
    export DSPACE_IMPORT_PATH="$IMPORT_PATH"
fi
