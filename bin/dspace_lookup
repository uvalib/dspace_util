#! /bin/bash
#
# Get JSON details of a single DSpace item.
#
# Usage: dspace_lookup [DEPLOYMENT] HANDLE
# Usage: dspace_lookup [DEPLOYMENT] UUID
#
# For convenience, a full path can be supplied and the item identifier will be
# extracted from it.
#
# The item may be a Collection, however DSpace only returns metadata about the
# Collection itself and does not provide a way to get the items associated with
# the Collection.

PROGRAM=`realpath "$0"`
BIN_DIR=`dirname "$PROGRAM"`

source "$BIN_DIR/dspace_values"

readonly REMOTE_HOST="$DSPACE_API"
readonly HANDLE_PREFIX="$DSPACE_PREFIX"

# =============================================================================
# Parse argument.
# =============================================================================

ITEM="$1"

case "$ITEM" in
    */handle/*) ITEM="${ITEM#*/handle/}" ;;
    */items/*)  ITEM="${ITEM#*/items/}" ;;
esac

# =============================================================================
# Get remote value(s)
# =============================================================================

case "$ITEM" in
    *-*)    URL_PATH="core/items/$ITEM"  ;; # Looks like a UUID
    */*)    URL_PATH="pid/find?id=$ITEM" ;; # Looks like a handle
    *)      URL_PATH="pid/find?id=$HANDLE_PREFIX/$ITEM" ;;
esac

curl -L "https://$REMOTE_HOST/server/api/$URL_PATH"
echo
